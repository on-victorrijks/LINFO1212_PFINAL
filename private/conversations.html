<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{{page.title}}</title>
  <meta name="description" content="{{page.description}}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/css/vars.css">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/menu.css">
  <link rel="stylesheet" href="/css/forms.css">
  <link rel="stylesheet" href="/css/conversations.css">

</head>
<body>

    <div class="menuContainer">
        <div class="fixedBtn" id="mobileOpen">
            <img src="/imgs/icons/menu_black_24dp.svg" alt="logo"/>
        </div>
        <div class="fixedBtn" id="mobileClose" hidden="true">
            <img src="/imgs/icons/close_black_24dp.svg" alt="logo"/>
        </div>
    
        <div class="menu" id="menu" mobileHidden="true">
    
            <nav class="menuElms">
    
                <div class="menuTopElements">
                    <a class="logo" href="/">
                        <img src="/imgs/logo.png" id="logo_long" alt="logo"/>
                        <img src="/imgs/logo_mini.png" id="logo_mini" alt="logo_mini"/>
                    </a>
                    {{#user}}
                    <a class="user" href="/account">
                        <div class="userImage">
                            <img src="https://localhost:8080/users/profilPicture/{{user._id}}" alt="user"/>
                        </div>
                        <div class="userText">
                            <h1>{{user.firstname}} {{user.lastname}}</h1>
                            <h2>Mon compte</h2>
                        </div>
                    </a>
                    {{/user}}
                    {{^user}}
                    <a class="registerorlogin" href="/login">
                        <h1>Se connecter / S'inscrire</h1>
                    </a>
                    {{/user}}
                </div>
                <div class="menuOptions">
    
                    {{#user}}
                    {{/user}}
                    {{^user}}
                    <a class="registerorlogin_mobile" href="/login">
                        <h1>Se connecter / S'inscrire</h1>
                    </a>
                    {{/user}}

                    <a class="option" selected="{{menu.selectedPage.home}}" href="/">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/search_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/search_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Accueil</h2>
                        </div>
                    </a>

                    {{#user}}
                    <a class="option" selected="{{menu.selectedPage.conversations}}" href="/conversations">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/question_answer_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/question_answer_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Messages</h2>
                        </div>
                    </a>
                    {{/user}}
                    {{^user}}
                    <a class="option" selected="{{menu.selectedPage.presentation}}" href="/presentation">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/view_module_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/view_module_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Présentation</h2>
                        </div>
                    </a>
                    {{/user}}
                    
                    {{#user}}
                    {{#user.isResident}}
                    <a class="option" selected="{{menu.selectedPage.favs}}" href="/kot/favs">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/favorite_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/favorite_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Mes favoris</h2>
                        </div>
                    </a>
                    
                    {{/user.isResident}}
                    {{/user}}

                    {{#user}}
                    {{#user.isLandlord}}
                    <a class="option" selected="{{menu.selectedPage.publish}}" href="/kot/create">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/add_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/add_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Publier un kot</h2>
                        </div>
                    </a>
                    <a class="option" selected="{{menu.selectedPage.mykots}}" href="/kot/my">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/home_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/home_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Mes kots</h2>
                        </div>
                    </a>
                    {{/user.isLandlord}}
                    {{/user}}
    
                    <a class="option" selected="{{menu.selectedPage.contact}}" href="/contact">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/call_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/call_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Contact</h2>
                        </div>
                    </a>
    
                </div>
                
                {{#user}}
                <div class="notificationsTab" hidden id="notificationsTab">
                    <div class="title">
                        <h1>Notifications</h1>
                        <button onClick="switchNotificationsTabVisibility()">
                            <img src="/imgs/icons/close_black_24dp.svg"/>
                        </button>
                    </div>
                    <div class="notificationsContainer" id="notificationsContainer">

                        <div class="notifBlocker"></div>

                    </div>
                </div>
                {{/user}}

                {{#user}}
                <div class="otherBtns">
                    <button id="showNotificationsTab" onClick="switchNotificationsTabVisibility()">
                        <div class="notifIndicator" id="notifIndicator"></div>
                        <img src="/imgs/icons/notifications_black_24dp.svg" alt="notifications"/>
                    </button>
                    <a href="/account/settings">
                        <img src="/imgs/icons/settings_black_24dp.svg" alt="settings"/>
                    </a>
                    <a href="/disconnect">
                        <img src="/imgs/icons/logout_black_24dp.svg" alt="disconnect"/>
                    </a>
                </div>
                {{/user}}
            </nav>
            
        </div>
    </div>

    <div class="g-background bgColor">

        <input type="hidden" id="connectedUserID" value="{{user._id}}">
        <input type="hidden" id="dyn_lastNumID" value="5000">
        <input type="hidden" id="selectedConversationID" value="{{selectedConversationID}}">

        <div class="g-content flexColumn blockHeight">

            <div class="g-topBar hiddenOnMobile">
                <div class="g-topTitle">
                    <h1>Mes conversations</b></h1>
                </div>
            </div>

            <div class="browsersContainer">

                <div class="conversationsBrowser">

                    {{#conversations}}
                    <div class="cB-conversation" 
                    id="conv_{{_id}}"
                    onClick="setConversation('conv_{{_id}}')"
                    convID="{{_id}}"
                    convName="{{conv_name}}"
                    isSelected="false"
                    passwordToJoin="{{passwordToJoin}}"
                    >
                        <div class="cB-conversation-image" numberOfUsers="{{conv_image.length}}">
                            {{#conv_image}}
                            <div class="cB-conversation-imageContainer">
                                <img src="https://localhost:8080/users/profilPicture/{{.}}"/>
                            </div>
                            {{/conv_image}}
                        </div>
                        <div class="cB-conversation-text">
                            <h1>{{conv_name}}</h1>
                            <h2>
                                {{#isLastMessageFromUser}}
                                <i>Vous: </i>
                                {{/isLastMessageFromUser}}
                                {{conv_lastmessage}}
                            </h2>
                        </div>
                    </div>
                    {{/conversations}}
                    {{^conversations}}
                    <div class="cB-noConversation">
                        <h2>Vous n'avez pas de conversation</h2>
                    </div>
                    {{/conversations}}

                </div>

                <div class="conversationWindow" id="conversationWindow" noConversationSelected>
                    <div class="cW-topBar">
                        <h1 id="dyn_convName"></h1>
                        <div style="flex:1"></div>
                        <button class="cW-topBar-iconButton" onClick="openModal('leaveGroupValidate')">
                            <img src="/imgs/icons/person_remove_black_24dp.svg"/>
                        </button>
                        <button class="cW-topBar-iconButton" onClick="openModal('removePeopleFromConversationModal');clearUsersInUsersList();getUsersFromConversation()">
                            <img src="/imgs/icons/group_remove_black_24dp.svg"/>
                        </button>
                        <button class="cW-topBar-iconButton" onClick="openModal('addPeopleToConversationModal')">
                            <img src="/imgs/icons/person_add_alt_black_24dp.svg"/>
                        </button>
                    </div>

                    <div class="cW-info-Container">
                        <div class="noConvSelectedBox">
                            <img src="imgs/illustration_messages.png"/>
                            <h1>Aucune conversation selectionnée</h1>
                            <h3>Vous pouvez créer une conversation en clickant sur "Envoyer un message" sur le profil d'un kot qui vous intérèsse</h3>
                        </div>
                        <div class="noMessageSelectedBox">
                            <img src="imgs/illustration_messages.png"/>
                            <h1>Oh non</h1>
                            <h3>Cette conversation ne contient pas de message, vous pouvez envoyer le premier !</h3>
                        </div>
                    </div>

                    <div class="cW-messagesBrowser" id="cW-messagesBrowser">

                        <button onClick="getMessages()" id="fetchMoreMessagesButton">Plus de messages</button>
                        <div class="messagesLoaderContainer" id="messagesLoaderContainer" hidden>
                            <div class="g-loader"><div></div><div></div></div>
                        </div>
                        <div id="messagesAnchor"></div>

                    </div>

                    <div class="cW-writeMessage">
                        <textarea name="message" id="messageInput" placeholder="Ecrivez un message" required></textarea>
                        <button type="button" id="sendMessageButton">
                            <img src="/imgs/icons/send_white_24dp.svg"/>
                        </button>
                        <input type="hidden" id="dyn_convID" value="">
                    </div>
                </div>

            </div>

        </div>

    </div>

    <div class="g-modalContainer" hidden id="modalContainer">

        <div class="g-modal" hidden id="addPeopleToConversationModal">
            <div class="g-modal-topBar">
                <h1>Ajouter des personnes à cette conversation</h1>
                <button class="close" onClick="closeModal('addPeopleToConversationModal')">
                    <img src="/imgs/icons/close_black_24dp.svg"/>
                </button>
            </div>
            <div class="g-modal-content">
                <p>Pour ajouter des personnes, il vous suffit de leur partager cette combinaison lien et mot de passe. En clickant dessus, ils pourront utiliser le mot de passe à garder secret ci-dessous et accepter votre invitation pour rejoindre cette discussion.</p>
                <br />
                <div class="form-copy">
                    <input class="copy" type="text" id="toCopy_invitationUrl" value="https://locahost:8080/invitations/..." readonly>
                    <button type="button" contentID="toCopy_invitationUrl" id="button_invitationUrl">Copier</button>
                </div>
                <br />
                <div class="form-copy">
                    <input class="copy" type="text" id="toCopy_password" value="..." readonly>
                    <button type="button" contentID="toCopy_password" id="button_invitationPassword">Copier</button>
                </div>
                <br />
                <div class="g-info-box noMargin">
                    <img src="/imgs/icons/info_accentColor_24dp.svg">
                    <p>
                        Attention : Le mot de passe ci-dessous est <b>UNIQUE</b> à cette conversation et <b>NON-MODIFIABLE</b>. Veillez donc à le partager d'une manière sécurisée.
                    </p>
                </div>

            </div>
        </div>

        <div class="g-modal" hidden id="removePeopleFromConversationModal">
            <div class="g-modal-topBar">
                <h1>Enlever des personnes de cette conversation</h1>
                <button class="close" onClick="closeModal('removePeopleFromConversationModal')">
                    <img src="/imgs/icons/close_black_24dp.svg"/>
                </button>
            </div>
            <div class="g-modal-content">
                <div class="usersList" id="usersListContainer">

                    <div class="usersList-loader" id="usersLoaderContainer" hidden>
                        <div class="g-loader"><div></div><div></div></div>
                        <h2>Chargement des utilisateurs...</h2>
                    </div>

                    <div class="usersList-empty" id="usersEmpty-removeUsers" hidden>
                        <h2>Aucun utilisateur trouvé</h2>
                    </div>

                </div>
            </div>
        </div>

        <div class="g-modal" hidden id="leaveGroupValidate">
            <div class="g-modal-topBar">
                <h1>Etes-vous sur de quitter cette conversation ?</h1>
                <button class="close" onClick="closeModal('leaveGroupValidate')">
                    <img src="/imgs/icons/close_black_24dp.svg"/>
                </button>
            </div>
            <div class="g-modal-content">
                <p>En quittant cette conversation vous n'aurez plus accès au messages précédemments envoyés.</p>
                <br />
                <button class="validate" onClick="leaveConversation()">Oui, je souhaite quitter cette conversation</button>
            </div>
        </div>

    </div>


</body>
<script src="/js/menu.js"></script>
{{#user}}
<script src="/js/notificationsManager.js"></script>
{{/user}}
<script src="/js/conversations.js"></script>