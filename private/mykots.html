<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{{page.title}}</title>
  <meta name="description" content="{{page.description}}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/css/vars.css">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/menu.css">
  <link rel="stylesheet" href="/css/forms.css">
  <link rel="stylesheet" href="/css/mykots.css">
  <link rel="stylesheet" href="/css/kotPreviewList.css">
  <link rel="stylesheet" href="/css/userPreview.css">

</head>
<body>

    {{#error}}
    <div class="g-alert" id="alerte_box">
        <h1 id="alert_title">{{title}}</h1>
        <p id="alert_desc">{{description}}</p>
        <div class="btnsContainer">
            {{#buttons}}
                <a href="{{action.redirectTo}}">{{title}}</a>
                <div class="spacer"></div>
            {{/buttons}}
            <button id="alert_close">Fermer</button>
        </div>
    </div>
    {{/error}}

    <div class="menuContainer">
        <div class="fixedBtn" id="mobileOpen">
            <img src="/imgs/icons/menu_black_24dp.svg" alt="logo"/>
        </div>
        <div class="fixedBtn" id="mobileClose" hidden="true">
            <img src="/imgs/icons/close_black_24dp.svg" alt="logo"/>
        </div>
    
        <div class="menu" id="menu" mobileHidden="true">
    
            <div class="menuElms">
    
                <div class="menuTopElements">
                    <a class="logo" href="/">
                        <img src="/imgs/logo.png" id="logo_long" alt="logo"/>
                        <img src="/imgs/logo_mini.png" id="logo_mini" alt="logo_mini"/>
                    </a>
                    {{#user}}
                    <a class="user" href="/account">
                        <div class="userImage">
                            <img src="https://localhost:8080/users/profilPicture/{{user._id}}" alt="user"/>
                        </div>
                        <div class="userText">
                            <h1>{{user.firstname}} {{user.lastname}}</h1>
                            <h2>Mon compte</h2>
                        </div>
                    </a>
                    {{/user}}
                    {{^user}}
                    <a class="registerorlogin" href="/login">
                        <h1>Se connecter / S'inscrire</h1>
                    </a>
                    {{/user}}
                </div>
                <div class="menuOptions">
    
                    {{#user}}
                    {{/user}}
                    {{^user}}
                    <a class="registerorlogin_mobile" href="/login">
                        <h1>Se connecter / S'inscrire</h1>
                    </a>
                    {{/user}}

                    <a class="option" selected="{{menu.selectedPage.home}}" href="/">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/search_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/search_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Accueil</h2>
                        </div>
                    </a>

                    {{#user}}
                    <a class="option" selected="{{menu.selectedPage.conversations}}" href="/conversations">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/question_answer_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/question_answer_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Messages</h2>
                        </div>
                    </a>
                    {{/user}}
                    {{^user}}
                    <a class="option" selected="{{menu.selectedPage.presentation}}" href="/presentation">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/view_module_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/view_module_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Présentation</h2>
                        </div>
                    </a>
                    {{/user}}
                    
                    {{#user}}
                    {{#user.isResident}}
                    <a class="option" selected="{{menu.selectedPage.favs}}" href="/kot/favs">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/favorite_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/favorite_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Mes favoris</h2>
                        </div>
                    </a>
                    
                    {{/user.isResident}}
                    {{/user}}

                    {{#user}}
                    {{#user.isLandlord}}
                    <a class="option" selected="{{menu.selectedPage.publish}}" href="/kot/create">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/add_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/add_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Publier un kot</h2>
                        </div>
                    </a>
                    <a class="option" selected="{{menu.selectedPage.mykots}}" href="/kot/my">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/home_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/home_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Mes kots</h2>
                        </div>
                    </a>
                    {{/user.isLandlord}}
                    {{/user}}
    
                    <a class="option" selected="{{menu.selectedPage.contact}}" href="/contact">
                        <div class="optionImage">
                            <img id="unselected" alt="menuOption" src="/imgs/icons/call_black_24dp.svg"/>
                            <img id="selected"   alt="menuOption" src="/imgs/icons/call_black_24dp_selected.svg"/>
                        </div>
                        <div class="optionName">
                            <h2>Contact</h2>
                        </div>
                    </a>
    
                </div>
                
                {{#user}}
                <div class="notificationsTab" hidden id="notificationsTab">
                    <div class="title">
                        <h1>Notifications</h1>
                        <button onClick="switchNotificationsTabVisibility()">
                            <img src="/imgs/icons/close_black_24dp.svg"/>
                        </button>
                    </div>
                    <div class="notificationsContainer" id="notificationsContainer">

                        <div class="notifBlocker"></div>

                    </div>
                </div>
                {{/user}}

                {{#user}}
                <div class="otherBtns">
                    <button id="showNotificationsTab" onClick="switchNotificationsTabVisibility()">
                        <div class="notifIndicator" id="notifIndicator"></div>
                        <img src="/imgs/icons/notifications_black_24dp.svg" alt="notifications"/>
                    </button>
                    <a href="/account/settings">
                        <img src="/imgs/icons/settings_black_24dp.svg" alt="settings"/>
                    </a>
                    <a href="/disconnect">
                        <img src="/imgs/icons/logout_black_24dp.svg" alt="disconnect"/>
                    </a>
                </div>
                {{/user}}
            </div>
            
        </div>
    </div>

    <div class="g-background bgColor">

        <div class="g-content">
            
            <div class="g-topBar">
                <div class="g-topTitle">
                    <h1>Vos kots</b></h1>
                </div>
            </div>

                
            <div class="kotsContainer">
                {{#ownKots}}
                <div class="kotPreviewList" kotID="{{_id}}">

                    <div class="table">
                        <div class="imageContainer">
                            <img alt="mainImage" src="https://localhost:8080/users/kots/images/{{_id}}_{{mainPictureName}}">
                        </div>

                        <div class="twoRowsInfosContainer">
                            <div class="infoContainer">
                                <h2>{{title}}</h2>
                            </div>
                            <div class="infoContainer">
                                <h2>{{basePrice}}€  <b>+ {{chargePrice}}€</b></h2>
                            </div>
                        </div>

                        <div class="twoRowsInfosContainer">
                            <div class="infoContainer">
                                <h2>{{location.address}}</h2>
                            </div>
                            <div class="infoContainer">
                                <h2>
                                    {{#isOpen}}
                                        Disponible
                                    {{/isOpen}}
                                    {{^isOpen}}
                                        Non-disponible
                                    {{/isOpen}}
                                </h2>
                            </div>
                        </div>

                        <div class="twoRowsInfosContainer">
                            <div class="infoContainer">
                                <h2>
                                    {{#isCollocation}}
                                        Colocation
                                    {{/isCollocation}}
                                    {{^isCollocation}}
                                        Pas une colocation
                                    {{/isCollocation}}
                                </h2>
                            </div>
                            <div class="infoContainer">
                                {{#isCollocation}}
                                <h2>{{collocationData.tenantsID.length}}/{{collocationData.maxTenant}} colocataires</h2>
                                {{/isCollocation}}
                            </div>
                        </div>

                        <div class="twoRowsInfosContainer">
                            <div class="buttonContainer">
                                <a href="/kot/profile/{{_id}}">Voir le Kot</a>
                            </div>
                            <div class="buttonContainer">
                                <a href="/kot/modify/{{_id}}">Modifier le Kot</a>
                            </div>
                        </div>

                        <div class="twoRowsInfosContainer">
                            {{#isCollocation}}
                            <div class="buttonContainer">
                                <a href="/conversations?selectedConversationID={{convID}}">Conversation du kot</a>
                            </div>
                            {{/isCollocation}}
                            <div class="buttonContainer">
                                <button onClick="deleteKot('{{_id}}')" class="delete">Supprimer</a>
                            </div>
                        </div>
                    </div>

                    {{#isCollocation}}
                    <button type="button" class="showCollocationData" onClick="showCollocationData('{{_id}}')">Afficher les données de la colocation</button>
                    {{/isCollocation}}

                </div>
                {{/ownKots}}
                {{^ownKots}}
                <div class="noKot">
                    <h3>Vous n'avez pas encore publié de kot</h3>
                    <a href="/kot/create">Publier un kot</a>
                </div>
                {{/ownKots}}
            </div>
        
        </div>
    
    </div>


    <div class="g-modalContainer" id="modalContainer" hidden>

        <div class="g-modal" id="addPeopleToConversationModal" hidden>
            <div class="g-modal-topBar">
                <h1>Données sur la colocation</h1>
                <button class="close" onClick="closeModal('addPeopleToConversationModal')">
                    <img src="/imgs/icons/close_black_24dp.svg"/>
                </button>
            </div>
            <div class="g-modal-content">

                <div class="collocation-loader" id="loading_collocation-data" hidden>
                    <div class="g-loader"><div></div><div></div></div>
                    <h2>Chargement des colocataires et des demandes...</h2>
                </div>

                <div class="collocation-data" id="collocation-data" hidden>
                    <div class="collocation-actual">
                        <h1>Colocataires actuels</h1>
                        <h2 id="noUser-actual" class="noUserFound" hidden>Aucun colocataire trouvé pour ce kot</h2>
                        <div class="usersPreviewContainer" id="actual-tenants">
                        
                        </div>
                    </div>
                    <div class="collocation-requests">
                        <h1>Demandes pour rejoindre cette colocation</h1>
                        <h2 id="noUser-requests" class="noUserFound" hidden>Aucune demande trouvée pour ce kot</h2>
                        <div class="usersPreviewContainer" id="requests-users">
                        
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>


</body>
<script src="/js/menu.js"></script>
<script src="/js/alert.js"></script>
<script src="/js/mykots.js"></script>
{{#user}}
<script src="/js/notificationsManager.js"></script>
{{/user}}